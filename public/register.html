<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>User Registration</title>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap4.min.css"
      integrity="sha512-PT0RvABaDhDQugEbpNMwgYBCnGCiTZMh9yOzUsJHDgl/dMhD9yjHAwoumnUk3JydV3QTcIkNDuN40CJxik5+WQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://use.fontawesome.com/releases/v5.0.6/css/all.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.datatables.net/buttons/2.3.5/css/buttons.dataTables.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-buttons-bs5/2.3.6/buttons.bootstrap5.min.css"
      integrity="sha512-vWTrt2A9iAn2pK8hNZS26YZRDDUvLiOfyL+MmBEXJizrigtxnpLuLrLOOMm+pcrUJFzGssUwoS6Gofp+TT2deQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.css"
      integrity="sha512-fjO3Vy3QodX9c6G9AUmr6WuIaEPdGRxBjD7gjatG5gGylzYyrEq3U0q+smkG6CwIY0L8XALRFHh4KPHig0Q1ug=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.4.min.js"
      integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"
      integrity="sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"
      integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.16.1/sweetalert2.min.js"
      integrity="sha512-LGHBR+kJ5jZSIzhhdfytPoEHzgaYuTRifq9g5l6ja6/k9NAOsAi5dQh4zQF6JIRB8cAYxTRedERUF+97/KuivQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>

  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h3 class="text-center">User Registration</h3>
            </div>
            <div class="card-body">
              <form id="registerForm">
                <div class="form-group">
                  <label for="name">Full Name:</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    required
                    placeholder="Enter your full name"
                  />
                </div>
                <div class="form-group">
                  <label for="email">Email Address:</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    required
                    placeholder="Enter your email address"
                  />
                </div>
                <div class="form-group">
                  <label for="password">Password:</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    name="password"
                    required
                    placeholder="Enter your password"
                    minlength="6"
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary btn-block"
                  id="register"
                >
                  <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                  <span id="buttonText">Register</span>
                </button>
              </form>
              <div class="text-center mt-3">
                <p>Already have an account? <a href="/login.html">Login here</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        $('#registerForm').submit(async function(e) {
          e.preventDefault();
          
          // Get form values
          const name = $('#name').val().trim();
          const email = $('#email').val().trim();
          const password = $('#password').val();
          
          // Client-side validation
          if (!name || !email || !password) {
            Swal.fire({
              icon: 'warning',
              title: 'Missing Information',
              text: 'Please fill in all required fields'
            });
            return;
          }
          
          if (password.length < 6) {
            Swal.fire({
              icon: 'warning',
              title: 'Password Too Short',
              text: 'Password must be at least 6 characters long'
            });
            return;
          }
          
          // Show loading state
          const submitBtn = $('#register');
          const loadingSpinner = $('#loadingSpinner');
          const buttonText = $('#buttonText');
          
          submitBtn.prop('disabled', true);
          loadingSpinner.removeClass('d-none');
          buttonText.text('Registering...');
          
          try {
            // Test connection first
            console.log('Attempting to connect to:', 'http://localhost:3000/api/register');
            
            const response = await fetch('/api/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ name, email, password })
});
            
            console.log('Response status:', response.status);
            
            const data = await response.json();
            console.log('Response data:', data);
            
            if (!response.ok) {
              throw new Error(data.error || 'Registration failed');
            }
            
            // Success notification
            Swal.fire({
              icon: 'success',
              title: 'Registration Successful!',
              text: 'You can now log in with your credentials',
              showConfirmButton: true,
              timer: 3000
            }).then(() => {
              // Clear form
              $('#registerForm')[0].reset();
              
              // Redirect to login page
              window.location.href = '/login.html';
            });
            
          } catch (error) {
            console.error('Full error details:', error);
            
            let errorMessage = 'Something went wrong. Please try again.';
            
            if (error.message === 'Failed to fetch') {
              errorMessage = 'Cannot connect to server. Please check:\n' +
                           '• Is the backend server running?\n' +
                           '• Is it running on port 3000?\n' +
                           '• Check browser console for details';
            } else {
              errorMessage = error.message;
            }
            
            // Error notification
            Swal.fire({
              icon: 'error',
              title: 'Registration Failed',
              text: errorMessage,
              footer: 'Check browser console (F12) for technical details'
            });
          } finally {
            // Reset button state
            submitBtn.prop('disabled', false);
            loadingSpinner.addClass('d-none');
            buttonText.text('Register');
          }
        });
        
        // Real-time email validation
        $('#email').on('blur', function() {
          const email = $(this).val();
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          
          if (email && !emailPattern.test(email)) {
            $(this).addClass('is-invalid');
            if (!$(this).siblings('.invalid-feedback').length) {
              $(this).after('<div class="invalid-feedback">Please enter a valid email address</div>');
            }
          } else {
            $(this).removeClass('is-invalid');
            $(this).siblings('.invalid-feedback').remove();
          }
        });
        
        // Real-time password validation
        $('#password').on('input', function() {
          const password = $(this).val();
          
          if (password.length > 0 && password.length < 6) {
            $(this).addClass('is-invalid');
            if (!$(this).siblings('.invalid-feedback').length) {
              $(this).after('<div class="invalid-feedback">Password must be at least 6 characters long</div>');
            }
          } else {
            $(this).removeClass('is-invalid');
            $(this).siblings('.invalid-feedback').remove();
          }
        });
      });
    </script>
  </body>
</html>